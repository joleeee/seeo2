<script>
    import { Line } from "svelte-chartjs";

    var source_xs = [
        2531, 2531, 2531, 2530, 2531, 2531, 2530, 2530, 2530, 2530, 2530, 2530,
        2530, 2529, 2529, 2529, 2529, 2529, 2529, 2528, 2528, 2528, 2528, 2528,
        2527, 2527, 2527, 2527, 2527, 2527, 2527, 2527, 2527, 2526, 2526, 2526,
        2526, 2526, 2526, 2525, 2525, 2525, 2525, 2525, 2525, 2525, 2525, 2525,
        2525, 2525, 2524, 2524, 2524, 2524, 2524, 2524, 2524, 2524, 2524, 2524,
        2524, 2523, 2523, 2523, 2523, 2523, 2523, 2523, 2523, 2523, 2522, 2522,
        2522, 2522, 2522, 2522, 2522, 2522, 2522, 2521, 2521, 2521, 2521, 2521,
        2521, 2521, 2521, 2521, 2521, 2521, 2521, 2521, 2521, 2520, 2521, 2520,
        2520, 2520, 2520, 2520, 2520, 2520, 2520, 2520, 2520, 2520, 2519, 2520,
        2519, 2519, 2519, 2520, 2519, 2519, 2519, 2519, 2519, 2519, 2519, 2518,
        2518, 2518, 2518, 2518, 2518, 2518, 2518, 2518, 2517, 2517, 2517, 2517,
        2517, 2517, 2517, 2516, 2517, 2517, 2516, 2516, 2516, 2516, 2516, 2516,
        2516, 2516, 2516, 2516, 2516, 2515, 2515, 2515, 2515, 2516, 2515, 2515,
        2515, 2515, 2515, 2515, 2515, 2515, 2515, 2515, 2515, 2515, 2514, 2514,
        2514, 2514, 2514, 2514, 2514, 2514, 2514, 2514, 2514, 2514, 2514, 2513,
        2514, 2513, 2513, 2513, 2513, 2513, 2513, 2513, 2513, 2512, 2512, 2512,
        2512, 2512, 2512, 2512, 2512, 2512, 2511, 2511, 2511, 2511, 2511, 2511,
        2511, 2511, 2511, 2511, 2511, 2511, 2511, 2511, 2510, 2510, 2511, 2510,
        2511, 2510, 2510, 2511, 2511, 2511, 2511, 2511, 2511, 2511, 2510, 2510,
        2510, 2510, 2511, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510,
        2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510,
        2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510,
        2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2510, 2509,
        2509, 2509, 2509, 2510, 2509, 2510, 2509, 2509, 2509, 2509, 2509, 2509,
        2509, 2509, 2509, 2509, 2509, 2509, 2509, 2509, 2509, 2508, 2509, 2509,
        2509, 2509, 2508, 2508, 2509, 2509, 2509, 2509, 2509, 2508, 2508, 2508,
        2508, 2508, 2508, 2508, 2508, 2508, 2508, 2508, 2508, 2508, 2508, 2508,
        2508, 2508, 2508, 2507, 2508, 2507, 2507, 2507, 2507, 2507, 2507, 2507,
        2507, 2507, 2507, 2507, 2507, 2507, 2507, 2507, 2507, 2507, 2507, 2507,
        2507, 2506, 2506, 2507, 2506, 2506, 2506, 2506, 2506, 2507, 2507, 2506,
        2506, 2506, 2506, 2506, 2507, 2506, 2506, 2506, 2506, 2506, 2506, 2505,
        2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2506, 2505, 2505,
        2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505,
        2505, 2505, 2505, 2505, 2505, 2505, 2505, 2505, 2504, 2505, 2505, 2505,
        2504, 2504, 2504, 2505, 2504, 2504, 2504, 2504, 2504, 2504, 2504, 2504,
        2504, 2504, 2504, 2503, 2504, 2503, 2503, 2503, 2503, 2503, 2503, 2503,
        2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503,
        2503, 2503, 2503, 2503, 2502, 2503, 2503, 2502, 2502, 2502, 2502, 2502,
        2502, 2502, 2503, 2502, 2502, 2502, 2503, 2503, 2502, 2503, 2503, 2503,
        2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503,
        2502, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503,
        2503, 2503, 2503, 2503, 2503, 2502, 2503, 2503, 2503, 2503, 2503, 2503,
        2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503, 2503,
        2502, 2502, 2502, 2503, 2503, 2503, 2503, 2502, 2502, 2502, 2502, 2502,
        2502, 2502, 2502, 2501, 2502, 2501, 2501, 2501, 2501, 2501, 2501, 2501,
        2501, 2501, 2501, 2500, 2500, 2500, 2500, 2500, 2500, 2500, 2499, 2499,
        2499, 2499, 2499, 2499, 2498, 2499, 2498, 2499, 2498, 2498, 2498, 2498,
        2498, 2498, 2498, 2498, 2498, 2498, 2498, 2498, 2498, 2498, 2498, 2498,
        2498, 2498, 2498, 2497, 2498, 2497, 2498, 2497, 2497, 2497, 2497, 2497,
        2497, 2497, 2497, 2497, 2497, 2497, 2497, 2497, 2497, 2496, 2497, 2497,
        2497, 2497, 2497, 2496, 2496, 2496, 2497, 2496, 2497, 2496, 2496, 2496,
        2497, 2497, 2497, 2496, 2497, 2496, 2497, 2496, 2496, 2497, 2497, 2496,
        2497, 2497, 2496, 2496, 2497, 2497, 2496, 2496, 2496, 2497, 2497, 2497,
        2497, 2497, 2497, 2497, 2497, 2497, 2497, 2496, 2497, 2496, 2497, 2497,
        2497, 2496, 2497, 2496, 2496, 2496, 2496, 2496, 2496, 2496, 2496, 2496,
        2496, 2496, 2496, 2496, 2496, 2496, 2496, 2495, 2496, 2496, 2495, 2495,
        2495, 2495, 2495, 2495, 2495, 2495, 2495, 2495, 2495, 2495, 2495, 2495,
        2495, 2495, 2495, 2495, 2495, 2495, 2495, 2494, 2495,
    ];

    $: xs = [...source_xs].map((v) => v / 100);

    $: latest = xs[xs.length - 1];

    $: data = {
        labels: [...Array(xs.length)].map((x, i) => i),
        datasets: [
            {
                label: "Temperature",
                fill: true,
                lineTension: 0.3,
                backgroundColor: "rgba(225, 204,230, .3)",
                borderColor: "rgb(205, 130, 158)",
                borderCapStyle: "butt",
                borderDash: [],
                borderDashOffset: 0.0,
                borderJoinStyle: "miter",
                pointBorderColor: "rgb(205, 130,1 58)",
                pointBackgroundColor: "rgb(255, 255, 255)",
                pointBorderWidth: 4,
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgb(0, 0, 0)",
                pointHoverBorderColor: "rgba(220, 220, 220,1)",
                pointHoverBorderWidth: 2,
                pointRadius: 1,
                pointHitRadius: 10,
                data: xs,
            },
        ],
    };

    import {
        Chart as ChartJS,
        Title,
        Tooltip,
        Legend,
        LineElement,
        LinearScale,
        PointElement,
        CategoryScale,
    } from "chart.js";

    ChartJS.register(
        Title,
        Tooltip,
        Legend,
        LineElement,
        LinearScale,
        PointElement,
        CategoryScale,
    );

    function addDatapoint() {
        const last = source_xs[source_xs.length - 1];
        const next = last + (Math.random() - 0.5) * 4;

        source_xs = [...source_xs, next];
    }

    let clear;
    $: {
        clearInterval(clear);
        clear = setInterval(addDatapoint, 1000);
    }
</script>

<p>Your current temp is {latest}.</p>

<Line {data} options={{ responsive: true, animation: { duration: 0 } }} />
